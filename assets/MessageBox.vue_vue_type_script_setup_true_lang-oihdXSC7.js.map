{"version":3,"file":"MessageBox.vue_vue_type_script_setup_true_lang-oihdXSC7.js","sources":["../../src/components/ftbot/PairSummary.vue","../../src/components/general/MessageBox.vue"],"sourcesContent":["<template>\r\n  <div>\r\n    <b-form-group v-if=\"backtestMode\" label-for=\"trade-filter\" class=\"mb-2 me-5\">\r\n      <b-form-input id=\"trade-filter\" v-model=\"filterText\" type=\"text\" placeholder=\"Filter\" />\r\n    </b-form-group>\r\n    <b-list-group>\r\n      <b-list-group-item\r\n        v-for=\"comb in combinedPairList\"\r\n        :key=\"comb.pair\"\r\n        button\r\n        class=\"d-flex justify-content-between align-items-center py-1\"\r\n        :active=\"comb.pair === botStore.activeBot.selectedPair\"\r\n        :title=\"`${comb.pair} - ${comb.tradeCount} trades`\"\r\n        @click=\"botStore.activeBot.selectedPair = comb.pair\"\r\n      >\r\n        <div>\r\n          {{ comb.pair }}\r\n          <span v-if=\"comb.locks\" :title=\"comb.lockReason\"> <i-mdi-lock /> </span>\r\n        </div>\r\n\r\n        <TradeProfit v-if=\"comb.trade && !backtestMode\" :trade=\"comb.trade\" />\r\n        <ProfitPill\r\n          v-if=\"backtestMode && comb.tradeCount > 0\"\r\n          :profit-ratio=\"comb.profit\"\r\n          :stake-currency=\"botStore.activeBot.stakeCurrency\"\r\n        />\r\n      </b-list-group-item>\r\n    </b-list-group>\r\n  </div>\r\n</template>\r\n\r\n<script setup lang=\"ts\">\r\nimport { formatPercent, timestampms } from '@/shared/formatters';\r\nimport { Lock, Trade } from '@/types';\r\n\r\nimport { useBotStore } from '@/stores/ftbotwrapper';\r\n\r\ninterface CombinedPairList {\r\n  pair: string;\r\n  lockReason: string;\r\n  profitString: string;\r\n  trade?: Trade;\r\n  locks?: Lock;\r\n  profit: number;\r\n  profitAbs: number;\r\n  tradeCount: number;\r\n}\r\nconst filterText = ref('');\r\n\r\nconst props = defineProps({\r\n  // TOOD: Should be string list\r\n  pairlist: { required: true, type: Array as () => string[] },\r\n  currentLocks: { required: false, type: Array as () => Lock[], default: () => [] },\r\n  trades: { required: true, type: Array as () => Trade[] },\r\n  sortMethod: { default: 'normal', type: String },\r\n  backtestMode: { required: false, default: false, type: Boolean },\r\n});\r\nconst botStore = useBotStore();\r\nconst combinedPairList = computed(() => {\r\n  const comb: CombinedPairList[] = [];\r\n\r\n  props.pairlist.forEach((pair) => {\r\n    const trades: Trade[] = props.trades.filter((el) => el.pair === pair);\r\n    const allLocks = props.currentLocks.filter((el) => el.pair === pair);\r\n    let lockReason = '';\r\n    let locks;\r\n\r\n    // Sort to have longer timeframe in front\r\n    allLocks.sort((a, b) => (a.lock_end_timestamp > b.lock_end_timestamp ? -1 : 1));\r\n    if (allLocks.length > 0) {\r\n      [locks] = allLocks;\r\n      lockReason = `${timestampms(locks.lock_end_timestamp)} - ${locks.reason}`;\r\n    }\r\n    let profitString = '';\r\n    let profit = 0;\r\n    let profitAbs = 0;\r\n    trades.forEach((trade) => {\r\n      profit += trade.profit_ratio;\r\n      profitAbs += trade.profit_abs ?? 0;\r\n    });\r\n    const tradeCount = trades.length;\r\n    const trade = tradeCount ? trades[0] : undefined;\r\n    if (trades.length > 0) {\r\n      profitString = `Current profit: ${formatPercent(profit)}`;\r\n    }\r\n    if (trade) {\r\n      profitString += `\\nOpen since: ${timestampms(trade.open_timestamp)}`;\r\n    }\r\n    if (\r\n      filterText.value === '' ||\r\n      pair.toLocaleLowerCase().includes(filterText.value.toLocaleLowerCase())\r\n    ) {\r\n      comb.push({ pair, trade, locks, lockReason, profitString, profit, profitAbs, tradeCount });\r\n    }\r\n  });\r\n\r\n  if (props.sortMethod === 'profit') {\r\n    comb.sort((a, b) => {\r\n      if (a.profit > b.profit) {\r\n        return -1;\r\n      }\r\n      return 1;\r\n    });\r\n  } else {\r\n    // sort Pairs: \"with open trade\" -> available -> locked\r\n    comb.sort((a, b) => {\r\n      if (a.trade && !b.trade) {\r\n        return -1;\r\n      }\r\n      if (a.trade && b.trade) {\r\n        // 2 open trade pairs\r\n        return a.trade.trade_id > b.trade.trade_id ? 1 : -1;\r\n      }\r\n      if (!a.locks && b.locks) {\r\n        return -1;\r\n      }\r\n      if (a.locks && b.locks) {\r\n        // Both have locks\r\n        return a.locks.lock_end_timestamp > b.locks.lock_end_timestamp ? 1 : -1;\r\n      }\r\n      return 1;\r\n    });\r\n  }\r\n  return comb;\r\n});\r\n</script>\r\n\r\n<style scoped>\r\n.list-group {\r\n  text-align: left;\r\n}\r\n</style>\r\n","<template>\r\n  <b-modal\r\n    ref=\"removeTradeModal\"\r\n    v-model=\"showRef\"\r\n    :title=\"title\"\r\n    @ok=\"msgBoxOK\"\r\n    @cancel=\"showRef = false\"\r\n    @keyup.esc=\"showRef = false\"\r\n    @keyup.enter=\"msgBoxOK\"\r\n  >\r\n    {{ message }}\r\n  </b-modal>\r\n</template>\r\n\r\n<script setup lang=\"ts\">\r\nexport interface MsgBoxObject {\r\n  title: string;\r\n  message: string;\r\n  accept: () => void;\r\n}\r\nconst showRef = ref<boolean>(false);\r\nconst title = ref<string>('');\r\nconst message = ref<string>('');\r\nconst accept = ref<() => void>(() => {\r\n  console.warn('Accepted not set.');\r\n});\r\n\r\nconst msgBoxOK = () => {\r\n  accept.value();\r\n  showRef.value = false;\r\n};\r\n\r\nconst show = (msg: MsgBoxObject) => {\r\n  title.value = msg.title;\r\n  message.value = msg.message;\r\n  showRef.value = true;\r\n  accept.value = msg.accept;\r\n};\r\n\r\ndefineExpose({ show });\r\n</script>\r\n\r\n<style scoped></style>\r\n"],"names":["filterText","ref","props","__props","botStore","useBotStore","combinedPairList","computed","comb","pair","trades","el","allLocks","lockReason","locks","a","b","timestampms","profitString","profit","profitAbs","trade","tradeCount","formatPercent","showRef","title","message","accept","msgBoxOK","__expose","msg"],"mappings":"m8BA+CM,MAAAA,EAAaC,EAAI,EAAE,EAEnBC,EAAQC,EAQRC,EAAWC,IACXC,EAAmBC,EAAS,IAAM,CACtC,MAAMC,EAA2B,CAAA,EAE3B,OAAAN,EAAA,SAAS,QAASO,GAAS,CACzB,MAAAC,EAAkBR,EAAM,OAAO,OAAQS,GAAOA,EAAG,OAASF,CAAI,EAC9DG,EAAWV,EAAM,aAAa,OAAQS,GAAOA,EAAG,OAASF,CAAI,EACnE,IAAII,EAAa,GACbC,EAGKF,EAAA,KAAK,CAACG,EAAGC,IAAOD,EAAE,mBAAqBC,EAAE,mBAAqB,GAAK,CAAE,EAC1EJ,EAAS,OAAS,IACpB,CAACE,CAAK,EAAIF,EACVC,EAAa,GAAGI,EAAYH,EAAM,kBAAkB,CAAC,MAAMA,EAAM,MAAM,IAEzE,IAAII,EAAe,GACfC,EAAS,EACTC,EAAY,EACTV,EAAA,QAASW,GAAU,CACxBF,GAAUE,EAAM,aAChBD,GAAaC,EAAM,YAAc,CAAA,CAClC,EACD,MAAMC,EAAaZ,EAAO,OACpBW,EAAQC,EAAaZ,EAAO,CAAC,EAAI,OACnCA,EAAO,OAAS,IACHQ,EAAA,mBAAmBK,EAAcJ,CAAM,CAAC,IAErDE,IACcH,GAAA;AAAA,cAAiBD,EAAYI,EAAM,cAAc,CAAC,KAGlErB,EAAW,QAAU,IACrBS,EAAK,oBAAoB,SAAST,EAAW,MAAM,kBAAmB,CAAA,IAEjEQ,EAAA,KAAK,CAAE,KAAAC,EAAM,MAAAY,EAAO,MAAAP,EAAO,WAAAD,EAAY,aAAAK,EAAc,OAAAC,EAAQ,UAAAC,EAAW,WAAAE,CAAY,CAAA,CAC3F,CACD,EAEGpB,EAAM,aAAe,SAClBM,EAAA,KAAK,CAACO,EAAGC,IACRD,EAAE,OAASC,EAAE,OACR,GAEF,CACR,EAGIR,EAAA,KAAK,CAACO,EAAGC,IACRD,EAAE,OAAS,CAACC,EAAE,MACT,GAELD,EAAE,OAASC,EAAE,MAERD,EAAE,MAAM,SAAWC,EAAE,MAAM,SAAW,EAAI,GAE/C,CAACD,EAAE,OAASC,EAAE,MACT,GAELD,EAAE,OAASC,EAAE,MAERD,EAAE,MAAM,mBAAqBC,EAAE,MAAM,mBAAqB,EAAI,GAEhE,CACR,EAEIR,CAAA,CACR,2nCCxGK,MAAAgB,EAAUvB,EAAa,EAAK,EAC5BwB,EAAQxB,EAAY,EAAE,EACtByB,EAAUzB,EAAY,EAAE,EACxB0B,EAAS1B,EAAgB,IAAM,CACnC,QAAQ,KAAK,mBAAmB,CAAA,CACjC,EAEK2B,EAAW,IAAM,CACrBD,EAAO,MAAM,EACbH,EAAQ,MAAQ,EAAA,EAUL,OAAAK,EAAA,CAAE,KAPDC,GAAsB,CAClCL,EAAM,MAAQK,EAAI,MAClBJ,EAAQ,MAAQI,EAAI,QACpBN,EAAQ,MAAQ,GAChBG,EAAO,MAAQG,EAAI,MAAA,EAGA"}